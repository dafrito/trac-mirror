<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include href="layout.html" />
  <head>
    <title>New Ticket</title>
    <script type="text/javascript" src="${chrome.htdocs_location}js/wikitoolbar.js"></script>
    <script type="text/javascript">
      $(document).ready(function() {$("#field-summary").get(0).focus()});
    </script>
  </head>

  <body>
    <div id="ctxtnav" class="nav"></div>

    <div id="content" class="ticket">
      <h1>Create New Ticket</h1>

      <form id="newticket" method="post" action="#preview">
        <div py:if="req.authname == 'anonymous'" class="field">
          <label for="field-reporter">Your email or username:</label><br />
          <input type="text" id="field-reporter" name="field_reporter" size="40" value="${ticket.reporter}" /><br />
        </div>
        <div class="field">
          <label for="field-summary">Short summary:</label><br />
          <input id="field-summary" type="text" name="field_summary" size="80" value="${ticket.summary}"/>
        </div>
        <div class="field">
          <label for="field-description">Full description (you may use <a tabindex="42"
                 href="${href.wiki('WikiFormatting')}">WikiFormatting</a> here):</label><br />
          <textarea id="field-description" name="field_description" class="wikitext" rows="10"
                 cols="78">${ticket.description}</textarea>
          <fieldset py:if="ticket.description" id="preview">
            <legend>Description Preview</legend>
            ${context.wiki_to_html(ticket.description)}
          </fieldset>
        </div>

        <fieldset id="properties" py:with="fields = [f for f in fields if not f.skip]">
          <legend>Ticket Properties</legend>
          <input type="hidden" name="action" value="create" />
          <input type="hidden" name="field_status" value="new" />

          <table>
            <tr py:for="row in group(fields, 2, lambda f: f.type != 'textarea')"
                py:with="fullrow = len(row) == 1">
              <py:for each="idx, field in enumerate(row)">
                <th class="col${idx + 1}" py:if="idx == 0 or not fullrow">
                  <label for="field-${field.name}" py:if="field"
                         py:strip="field.type == 'radio'">${field.label or field.name}:</label>
                </th>
                <td class="col${idx + 1}" py:if="idx == 0 or not fullrow"
                    py:attrs="{'colspan': fullrow and 3 or None}">
                  <py:choose test="field.type" py:if="field">
                    <select py:when="'select'" id="field-${field.name}" name="field_${field.name}">
                      <option py:if="field.optional"></option>
                      <option py:for="option in field.options"
                              selected="${ticket[field.name] == option or None}"
                              py:content="option"></option>
                    </select>
                    <textarea py:when="'textarea'" id="field-${field.name}" name="field_${field.name}"
                              cols="${field.width}" rows="${field.height}"
                              py:content="ticket[field.name]"></textarea>
                    <span py:when="'checkbox'">
                      <input type="checkbox" id="field-${field.name}" name="field_${field.name}"
                             checked="${field.value == '1' and 'checked' or None}" value="1" />
                      <input type="hidden" name="field_checkbox_${field.name}" value="1" />
                    </span>
                    <label py:when="'radio'"
                           py:for="idx, option in enumerate(field.options)">
                      <input type="radio" name="field_${field.name}" value="${option}"
                             checked="${ticket[field.name] == option or None}" />
                      ${option}
                    </label>
                    <input py:otherwise="" type="text" id="field-${field.name}"
                           name="field_${field.name}" value="${ticket[field.name]}" />
                  </py:choose>
                </td>
              </py:for>
            </tr>
          </table>
        </fieldset>

        <p py:if="can_attach">
          <label>
            <input type="checkbox" name="attachment" checked="${attachment or None}" />
            I have files to attach to this ticket
          </label>
        </p>
        <div class="buttons">
          <input type="submit" name="preview" value="Preview" accesskey="r" />&nbsp;
          <input type="submit" value="Submit ticket" />
        </div>
      </form>

      <div id="help">
        <strong>Note:</strong> See
        <a href="${href.wiki('TracTickets')}">TracTickets</a> for help on using
        tickets.
      </div>
    </div>
  </body>
</html>
